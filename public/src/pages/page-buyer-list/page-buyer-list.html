<link rel="import" href="./../../../bower_components/polymer/polymer.html">
<link rel="import" href="./../../layout/page-style.html">
<link rel="import" href="components/buyer-list.html">
<link rel="import" href="./../../../bower_components/nylon-panel/nylon-panel-right.html">
<link rel="import" href="./../../../bower_components/paper-fab/paper-fab.html">
<link rel="import" href="./../../../bower_components/paper-tooltip/paper-tooltip.html">
<link rel="import" href="./../page-contract-list/components/contract-detail.html">
<link rel="import" href="./../../layout/shared-styles.html">


<dom-module id="page-buyer-list">
    <template>
        <style include="page-style shared-styles">
             :host {
                --paper-fab-background: var(--paper-light-blue-500);
                --paper-fab-keyboard-focus-background: var(--paper-light-blue-900);
            }

            * {
                font-family: 'CSChatThaiUI', sans-serif;
                -webkit-font-smoothing: antialiased;
            }

            nylon-panel-right {
                --app-toolbar-style: {
                    background-color: #FF5000;
                }
            }
        </style>
        <div class="xcontainer ">
            <template is="dom-repeat" items={{buyerList}} index-as=index>
                <buyer-list data="[[item]]"></buyer-list>
            </template>
        </div>
        <nylon-panel-right title="{{titlePanelRight}}" id="drawerRight" set-width="95%">
            <div class="rightdata" align="left">
                <contract-detail></contract-detail>
            </div>
        </nylon-panel-right>
        <div class="btnFab">
            <paper-fab icon="add" title="เพิ่มประเทศ" id="addCountry" on-tap="addCountry"></paper-fab>
            <paper-tooltip for="addCountry" offset="0">เพิ่มประเทศ</paper-tooltip>
        </div>

    </template>
    <script>
        Polymer({
            is: 'page-buyer-list',
            behaviors: [ReduxBehavior, nylonBehavior, i18nAction, contractAction, commonG2gAction,
                commonStateAction],
            properties: {
                titlePanelRight: {
                    type: String,
                    value: 'การซื้อขายข้าวระหว่างประเทศ'
                },
                localize: {
                    statePath: 'i18n.g2g'
                },
                buyerList: {
                    statePath: 'contract.buyerList'
                },
            },
            listeners: {
                'close-drawer': '_flipDrawerClose',
            },
            nylonPageActive: function () {

                this.dispatchAction('GET_BUYER_LIST');

                // this.dispatchAction('GET_COMMON_BANK_LIST');
                this.dispatchAction('GET_COMMON_HAMONIZE_LIST');
                this.dispatchAction('GET_COMMON_BUYER_LIST');
                // this.dispatchAction('GET_COMMON_CARRIER_LIST');
                // this.dispatchAction('GET_COMMON_INCOTERMS_LIST');
                // this.dispatchAction('GET_COMMON_NOTIFY_LIST');
                // this.dispatchAction('GET_COMMON_PACKAGE_LIST');
                // this.dispatchAction('GET_COMMON_PORT_LIST');
                // this.dispatchAction('GET_COMMON_SHIP_LIST');
                // this.dispatchAction('GET_COMMON_SHIPLINE_LIST');
                // this.dispatchAction('GET_COMMON_SURVEYOR_LIST');
                // console.log(111);
            },
            // _getCountry() {
            //     this.read('./g2g/contract/list', (data) => {
            //         this.set('countryList', data)
            //     });
            // },
            // getContractList(e) {
            //     // console.log(e.detail.buyer_id);
            //     document.cookie = "buyerId=" + e.detail.buyer_id
            //     this.fire('nylon-change-page', { path: '/g2g' })
            // },
            // _getDataForContract: function () {
            //     //use data for contract
            //     this.read(window._config.externalServerCommon+'/api/buyer', (data) => {
            //         this.dataForSelected.dataForContract.buyer = data;
            //         this.notifyPath('dataForSelected.dataForContract.buyer');
            //     });
            //     this.read(window._config.externalServerCommon+'/api/hamonize?group=g2g', (data) => {
            //         data.map((set_name) => {
            //             set_name.type_rice_name_th = '('+ set_name.type_rice_id+ ') ' +set_name.type_rice_name_th
            //             set_name.type_rice_name_en = '('+ set_name.type_rice_id+ ') ' +set_name.type_rice_name_en
            //         })
            //         this.dataForSelected.dataForContract.typeRice = data;
            //         this.notifyPath('dataForSelected.dataForContract.typeRice');
            //         // console.log(this.dataForSelected);
            //     });
            //     this.read(window._config.externalServerCommon+'/api/incoterms', (data) => {
            //         this.dataForSelected.dataForContract.incoterms = data;
            //         this.notifyPath('dataForSelected.dataForContract.incoterms');
            //     });
            //     //end use data for contract
            // },
            addCountry() {
                this.titlePanelRight = 'เพิ่มสัญญาการซื้อขาย'
                this.dispatchAction('CLEAR_CONTRACT')
                this.dispatchAction('SET_STATE', {
                    isInsert: true,
                    btnDisabled: false,
                    hiddend: true
                })
                this.fire('toast', { status: 'load' });
                this.async(() => {
                    this.fire('toast', {
                        status: 'success', text: 'โหลดสำเร็จ', callback: () => {
                            this._flipDrawer();
                        }
                    })

                }, 500)

            },
            _flipDrawer: function () {
                Polymer.dom(this.root).querySelector('#drawerRight').open();
            },
            _flipDrawerClose: function () {
                Polymer.dom(this.root).querySelector('#drawerRight').close();
            }
        });
    </script>
</dom-module>