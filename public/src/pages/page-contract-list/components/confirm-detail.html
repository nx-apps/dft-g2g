<link rel="import" href="./../../../../bower_components/paper-button/paper-button.html">
<link rel="import" href="./../../../../bower_components/gl-form/gl-form-input.html">
<link rel="import" href="./../../../../bower_components/vaadin-date-picker/vaadin-date-picker.html">
<link rel="import" href="./../../../../bower_components/gl-form/gl-form-panel.html">
<link rel="import" href="./../../../../bower_components/gl-form/gl-combo-box.html">
<link rel="import" href="./../../components/g2g-logic-behavior.html">
<link rel="import" href="./../../components/format-number-behavior.html">
<link rel="import" href="./../../components/validateFormBehaviors.html">
<dom-module id="confirm-detail">
  <style is="custom-style" include="iron-flex iron-flex-alignment gl-styles page-style">
    * {
      font-family: 'CSChatThaiUI', sans-serif;
      -webkit-font-smoothing: antialiased;
    }

    .top {
      margin-top: 15px;
      font-size: var(--font-size-h5);
    }

    table.gl-table-default {
      width: 98%;
      border: 1px solid #ddd;
      margin-bottom: 15px;
    }

    paper-button {
      margin-top: 10px;
    }

    gl-form-textarea {
      word-break: break-all;
    }

    paper-icon-button {
      margin-top: 10px;
    }

    paper-icon-button.crud {
      margin: 5px 5px 5px 5px;
    }

    paper-icon-button.crud:hover {
      background-color: var(--paper-grey-200);
      border-radius: 5px;
      box-shadow: inset 0 0 3px 3px rgba(0, 0, 0, .2);
    }

    paper-button.btnInTable {
      --paper-button: {
        margin-top: 0px;
        height: 30px;
      }
    }

    gl-combo-box.InTable {
      margin-top: -20px;
    }

    .numberBack {
      text-align: right;
    }

    .btnCenter {
      text-align: center;
    }

    iron-icon {
      height: 16px;
      width: 16px;
      margin-right: 8px;
    }
  </style>
  <template>
    <!--<template is="dom-if" if="[[commonState.btnDisabled]]">-->
    <paper-button raised on-tap="backPage" class="gl-btn-default">{{localize.btn_back_ward}}</paper-button>
    <!--</template>-->
    <template is="dom-if" if="[[!commonState.btnDisabled]]">
      <paper-button raised on-tap="backPageInsert" class="gl-btn-default" hidden="[[isViewSeleted]]">{{localize.btn_back_ward}}</paper-button>
    </template>
    <gl-form-panel set-padding="10px 20px 10px 20px" set-border="1px">
      <template is="dom-if" if="[[!data.cl_status]]">
        <template is="dom-if" if="[[!commonState.isInsert]]">
          <div class="horizontal end-justified layout">
            <paper-icon-button id="edit" class="crud" icon="create" raised on-tap="editConfirm" disabled="[[!commonState.btnDisabled]]"></paper-icon-button>
            <paper-tooltip for="edit" offset="0">แก้ไข</paper-tooltip>
            <paper-icon-button id="delete" class="crud" icon="delete" raised on-tap="deleteConfirm" disabled="[[!commonState.btnDisabled]]"></paper-icon-button>
            <paper-tooltip for="delete" offset="0">ลบ</paper-tooltip>
          </div>
        </template>
      </template>
      <gl-grid-row width="{{getWidth}}">
        <gl-grid-col width="[[getWidth]]" grid="[[300,12],[500,2]]">
          [[changeString2Num(data.*,'cl_no')]]
          <gl-form-input class="required" required autofocus allowed-pattern="[0-9||,||.]" format-number="on" disabled="[[commonState.btnDisabled]]"
            error-message="{{localize.label_error_order}}" required label="{{localize.label_ref_no}}" always-float-label value="{{data.cl_no}}"></gl-form-input>
        </gl-grid-col>
        <gl-grid-col width="[[getWidth]]" grid="[[300,12],[500,3]]">
          <!--<vaadin-date-picker class="required" required disabled="[[commonState.btnDisabled]]" label="{{localize.label_date}}" value="{{data.cl_date}}"></vaadin-date-picker>-->
          <gl-form-input type="date" class="required" required disabled="[[commonState.btnDisabled]]" label="{{localize.label_date}}"
            value="{{data.cl_date}}"></gl-form-input>

        </gl-grid-col>
      </gl-grid-row>

      <div class="top ">{{localize.label_detail}}</div>

      <template is="dom-repeat" items="[[data.cl_hamonize]]">
        <div class="bg">
          <gl-form-panel set-padding="10px 20px 10px 20px" set-border="1px">
            <div class="horizontal end-justified layout">
              <paper-button id="[[index]]" raised class="btnInTable gl-btn-danger" on-tap="deleteRiceType" style="margin-top:16px" hidden="[[commonState.btnDisabled]]">
                <iron-icon icon="remove"></iron-icon>{{localize.btn_delete_rice_type}}</paper-button>
            </div>
            <gl-grid-row>
              <gl-grid-col width="[[getWidth]]" grid="[[300,12],[500,6]]">

                <gl-combo-box id="riceType-[[index]]" index="[[index]]" class="required" required disabled="[[commonState.btnDisabled]]"
                  error-message="{{localize.label_error_rice_type}}" placeholder="{{localize.label_rice_type}}" name="hamonize.hamonize_th"
                  label="{{localize.label_rice_type}}" item-label-path="label" item-value-path="hamonize_id" value="{{item.hamonize_id}}"
                  on-selected-item-changed="getObjectHamonize" on-value-changed="_typeRiceConfirm">
                  <template>
                    [[item.label]]
                  </template>
                </gl-combo-box>

              </gl-grid-col>
              <gl-grid-col width="[[getWidth]]" grid="[[300,12],[500,3]]">

                [[changeString2Num(item.*,'hamonize_weight')]] [[_obCalcWeight(item.*,'hamonize_weight')]]
                <gl-form-input class="required" id="[[index]]" required allowed-pattern="[0-9||,||.]" format-number="on" disabled="[[commonState.btnDisabled]]"
                  label="{{localize.label_quantity}}" placeholder="{{localize.label_quantity}}" error-message="{{localize.label_error_quantity}}"
                  value="{{item.hamonize_weight}}" name="hamonize_weight" on-value-changed="getCostPrice"></gl-form-input>

              </gl-grid-col>
              <gl-grid-col width="[[getWidth]]" grid="[[300,12],[500,3]]">[[changeString2Num(item.*,'tolerance_rate')]]
                <gl-form-input class="required number" required maxlength="3" allowed-pattern="[0-9||,||.]" error-message="{{localize.label_error_tolerance_rate}}"
                  disabled="[[commonState.btnDisabled]]" label="{{localize.label_tolerance_rate}}" value="{{item.tolerance_rate}}"
                  placeholder="{{localize.label_tolerance_rate}}" error-message="{{localize.label_error_tolerance_rate}}" id="tolerance_rate">
                  <div suffix>%</div>
                </gl-form-input>
              </gl-grid-col>

            </gl-grid-row>

            <gl-grid-row>
              <gl-grid-col width="[[getWidth]]" grid="[[300,12],[500,3]]">
                <gl-form-input class="required" required disabled="[[commonState.btnDisabled]]" label="{{localize.label_project_th}}" placeholder="{{localize.label_project_th}}"
                  value="{{item.project_th}}" error-message="{{localize.label_error_project_en}}"></gl-form-input>
              </gl-grid-col>
              <gl-grid-col width="[[getWidth]]" grid="[[300,12],[500,3]]">
                <gl-form-input class="required" required disabled="[[commonState.btnDisabled]]" label="{{localize.label_project_en}}" placeholder="{{localize.label_project_en}}"
                  value="{{item.project_en}}" error-message="{{localize.label_error_project_en}}"></gl-form-input>
              </gl-grid-col>
              <gl-grid-col width="[[getWidth]]" grid="[[300,12],[500,3]]">
                [[changeString2Num(item.*,'cost_price')]]
                <gl-form-input disabled="[[commonState.btnDisabled]]" format-number="on" value="{{item.cost_price}}" label="{{localize.label_cost_price_ton}}"></gl-form-input>
              </gl-grid-col>
              <gl-grid-col width="[[getWidth]]" grid="[[300,12],[500,3]]">
                [[changeString2Num(item.*,'cost_value')]]
                <gl-form-input disabled="[[commonState.btnDisabled]]" format-number="on" value="{{item.cost_value}}" label="ราคาบาท (ยัง)"></gl-form-input>

              </gl-grid-col>
            </gl-grid-row>

            <br>
            <table class="gl-table-default" id="[[index]]">
              <thead class="table-head">
                <tr>
                  <th style="text-align: center; width: 30%">{{localize.text_packaging_type}} <br> {{localize.text_kk_sack}}</th>
                  <th style="text-align: center; width: 20%">{{localize.text_price}}<br> {{localize.text_usd_ton}}</th>
                  <th style="text-align: center; width: 20%">{{localize.text_weight_sacks}} <br>{{localize.text_gram}}</th>
                  <th style="text-align: center; width: 30%">
                    <template is="dom-if" if="[[!commonState.btnDisabled]]">
                      {{localize.label_action}}
                    </template>
                  </th>
                </tr>
              </thead>
              <tbody class="table-body">
                <template is="dom-repeat" as="packageitem" items="[[item.package]]" index-as=indexpackeage>
                  <tr>
                    <td>

                      <gl-combo-box id="package-[[index]]-[[indexpackeage]]" index="[[index]]" indexpackeage=[[indexpackeage]] class="required InTable"
                        required disabled="[[commonState.btnDisabled]]" error-message="{{localize.label_error_package}}" placeholder="{{localize.label_package}}"
                        item-label-path="package_name_th" item-value-path="package_id" value="{{packageitem.package_id}}" on-selected-item-changed="getObjectPackeage"
                        on-value-changed="_typePackageConfirm">
                        <template>
                          [[item.package_name_th]]
                        </template>
                      </gl-combo-box>

                    </td>
                    <td> [[changeString2Num(packageitem.*,'price_d')]]
                      <gl-form-input class="required numberBack" required allowed-pattern="[0-9||,||.]" format-number="on" disabled="[[commonState.btnDisabled]]"
                        placeholder="{{localize.text_price}}" error-message="{{localize.text_error_price}}" value="{{packageitem.price_d}}"
                        no-label-float></gl-form-input>
                    </td>
                    <td>
                      <gl-form-input class="numberBack" disabled value="[[_obChangePrice(packageitem.package_id,packageList)]]" name="package_weight_bag"
                        no-label-float></gl-form-input>
                    </td>
                    <td style="text-align:center;">
                      <paper-button id-packeage="[[indexpackeage]]" id-table="[[index]]" raised class="btnInTable gl-btn-danger" on-tap="delePackage"
                        hidden="[[commonState.btnDisabled]]" disabled="[[_isHaveForDelete(item.package,item.package.*)]]">
                        <iron-icon icon="remove"></iron-icon>{{localize.btn_delete}}</paper-button>
                    </td>
                  </tr>
                </template>
              </tbody>
            </table>
            <div class="horizontal end-justified layout">
              <paper-button raised id="[[index]]" class="btnInTable gl-btn-primary" on-tap="addPackage" hidden="[[commonState.btnDisabled]]"
                disabled="[[!_isHaveForUse(item.package,packageList,item.package.*)]]">
                <iron-icon icon="add"></iron-icon>{{localize.btn_add_package}}</paper-button>
            </div>
          </gl-form-panel>
        </div>
      </template>
      <div class="horizontal end-justified layout">

        <template is="dom-if" if="[[!commonState.btnDisabled]]">
          <paper-button raised on-tap="addNewTypeRice" class="gl-btn-primary" hidden="[[btnCheckDisabled]]" disabled="[[!_isHaveForUse(data.cl_hamonize,hamonizeContract,data.cl_hamonize.*)]]">
            <iron-icon icon="add"></iron-icon>{{localize.btn_add_rice_type}}</paper-button>
        </template>
      </div>
      <gl-grid-row>
        <gl-grid-col width="[[getWidth]]" grid="[[300,12],[500,5]]">
          <template is="dom-repeat" items="[[data.incoterms]]">
            <gl-combo-box id="incoterms-[[index]]" index="[[index]]" class="required" required disabled="[[commonState.btnDisabled]]"
              label="{{localize.label_incoterms}} [[_ObcountIndex(index)]]" error-message="{{localize.label_error_incoterms}} [[_ObcountIndex(index)]]"
              placeholder="{{localize.label_incoterms}} [[_ObcountIndex(index)]]" item-label-path="inct_name" item-value-path="inct_id"
              value="{{item.inct_id}}" on-selected-item-changed="getObjectIncoterms" on-blur="_incotermsConfirm">
              <template>
                [[item.inct_name]]
              </template>
            </gl-combo-box>
          </template>
        </gl-grid-col>
        <gl-grid-col width="[[getWidth]]" grid="[[300,12],[500,3]]">
          <gl-form-input class="numberBack" disabled allowed-pattern="[0-9||,||.]" format-number="on" always-float-label label="{{localize.label_total_ton}}"
            value="{{dataShow.cl_total_quantity}}"></gl-form-input>
        </gl-grid-col>
        <gl-grid-col width="[[getWidth]]" grid="[[300,12],[500,3]]">
          <gl-form-input class="numberBack" disabled format-number="on" label="{{localize.label_total_cost_price_ton}}" value="[[dataShow.cl_total_costpriceton]]"></gl-form-input>
        </gl-grid-col>
        <gl-grid-col width="[[getWidth]]" grid="[[300,12],[500,5]]"></gl-grid-col>
        <gl-grid-col width="[[getWidth]]" grid="[[300,12],[500,3]]"></gl-grid-col>
        <gl-grid-col width="[[getWidth]]" grid="[[300,12],[500,3]]"></gl-grid-col>
      </gl-grid-row>
      <gl-grid-row>
        <div class="horizontal start-justified layout">
          <paper-button raised class="gl-btn-primary" on-tap="addincoterms" hidden="[[commonState.btnDisabled]]" disabled="[[!_isHaveForUse(data.incoterms,incotermsList,data.incoterms.*)]]">
            <iron-icon icon="add"></iron-icon>{{localize.btn_add}}</paper-button>
          <paper-button raised class="gl-btn-danger" on-tap="deleteIncoterms" hidden="[[commonState.btnDisabled]]" disabled="[[_isHaveForDelete(data.incoterms,data.incoterms.*)]]">
            <iron-icon icon="remove"></iron-icon>{{localize.btn_delete}}</paper-button>
        </div>
      </gl-grid-row>

      <div class="horizontal end-justified layout">
        <template is="dom-if" if="[[commonState.isInsert]]">
          <paper-button class="gl-btn-primary" on-tap="insertConfirm" raised>{{localize.btn_add}}</paper-button>
        </template>
        <template is="dom-if" if="[[commonState.btnDisabled]]">
          <paper-button class="gl-btn-info" raised on-tap="confirmConfirm" hidden="[[data.cl_status]]">{{localize.btn_confirm}}</paper-button>
        </template>
        <template is="dom-if" if="[[!commonState.isInsert]]">
          <paper-button class="gl-btn-default" on-tap="canncelConfirm" raised hidden="[[commonState.btnDisabled]]">{{localize.btn_cancel}}</paper-button>
          <paper-button class="gl-btn-success" on-tap="saveConfirm" raised hidden="[[commonState.btnDisabled]]">{{localize.btn_save}}</paper-button>
        </template>
      </div>
    </gl-form-panel>
  </template>
  <script>
    Polymer({
      is: "confirm-detail",
      behaviors: [
        ReduxBehavior,
        nylonBehavior,
        FormatNumberBehavior,
        g2gLogicBehavior,
        CookieBehavior,
        ValidateFormBehavior
        // g2gCongtroller,
        // nylonLocalizeBehavior,
      ],
      properties: {
        localize: {
          statePath: 'i18n.g2g'
        },
        commonState: {
          statePath: 'commonState.setState'
        },
        data: {
          statePath: 'confirmLetter.contractDetail',
        },
        hamonizeContract: {
          statePath: 'confirmLetter.hamonizeContract',
          // observer: 'get'
        },
        hamonizeFp: {
          statePath: 'confirmLetter.hamonizeFp',
          // observer: 'get'
        },
        contractId: {
          statePath: 'commonState.contractId',
          // observer: 'get'
        },
        packageList: {
          statePath: 'commonG2g.packageList',
          // observer: 'get'
        },
        incotermsList: {
          statePath: 'commonG2g.incotermsList',
          // observer: 'get'
        },

        dataShow: {
          type: Object,
          value: {
            cl_hamonize: [],
            cl_hamonize_pk: [{ package: [{ package: {} }] }]
            , incoterms: []
          }
        },

        // data: {
        //   type: Object,
        //   value: { cl_total_costPrice: 0, hamonize_weight: 0, cl_hamonize: [{ package: [{ package_id: '', price_d: 0, }] }], incoterms: [{ inct_id: 'd' }] }
        // },
      },
      // get(data){
      //   console.log(this.contractId)
      //   console.log(this.commonState)
      // },
      observers: [
        // '_changeDataConfirm(data.cl_date)',
        '_typeRiceConfirm(data.*)',
        '_typePackageConfirm(data.*)',
        '_incotermsConfirm(data.*)',
        '_isHaveForUse(data.cl_hamonize,hamonizeContract,data.cl_hamonize.*)'
      ],
      // listeners: {
      //   'edit-input': 'editInput',
      //   'delete-input': 'deleteConfirm'
      // },
      // created: function () {
      //   this.nylonLocalizeImport('/i18n-page1.json');
      // },
      // // attached: function() {
      // //   this._typeRiceConfirm();
      // //   this._typePackageConfirm();
      // // },
      // _changeDataConfirm: function (dateUn) {
      //   this.getDateg2g(dateUn, (date) => {
      //     this.set('data.cl_date', date);
      //     this.notifyPath('data.cl_date');
      //   });
      // },
      canncelConfirm: function () {
        this.fire('toast', {
          status: 'openDialog',
          text: 'ต้องการยกเลิกแก้ข้อมูลใช่หรือไม่ ?',
          confirmed: (result) => {
            if (result == true) {
              this.dispatchAction('GET_CONFIRM_DETAIL', this.data.id)
              this.dispatchAction('SET_STATE', {
                isInsert: false,
                btnDisabled: true,
                hiddend: true
              })
              this.queryFrom('.required').map((el) => { el.reset(); });
            }
          }
        })
      },
      deleteRiceType: function (e) {
        this.splice('data.cl_hamonize', e.currentTarget.id, 1);
      },
      delePackage: function (e) {
        // let table = Polymer.dom(Polymer.dom(Polymer.dom(Polymer.dom(Polymer.dom(e.currentTarget).parentNode).parentNode).parentNode).parentNode);
        // console.log(table);
        // console.log(e.currentTarget.idPackeage,'e',e.currentTarget.idTable);
        this.splice('data.cl_hamonize.' + [e.currentTarget.idTable] + '.package', e.currentTarget.idPackeage, 1);
      },
      addincoterms: function () {
        this.push('data.incoterms', { inct_id: '' });
        this.notifyPath('data.incoterms');
      },
      deleteIncoterms: function () {
        if (this.data.incoterms.length > 1) {
          this.pop('data.incoterms');
        }
      },
      _obCalcWeight: function (data, hamonize_weight) {
        let total = 0;
        let datas = this.data.cl_hamonize;
        for (index in datas) {
          total += parseFloat(datas[index].hamonize_weight);

        }
        // this.cl_total_quantity=this._isNan(total);
        this.dataShow.cl_total_quantity = this._isNan(total);
        this.set('data.cl_weight', total)
        this.notifyPath('dataShow.cl_total_quantity');

        // this.cl_total_quantity = numeral(total).format('0,0');

      },
      //เปลี่ยนเป็น observer ด้วย
      getCostPrice: function (e) {
        try {
          if (this.data.cl_date !== undefined && this.data.cl_date !== ''
            && e.model.item.hamonize_id !== '') {
            let index = e.currentTarget.id
            let hm_id = e.model.item.hamonize_id
            let date = new Date(this.data.cl_date)
            let lastMonth = new Date(date.setMonth(date.getMonth() - 3)).toISOString().split('T')[0]
            // console.log(lastMonth)
            // this.hamonizeContract
            let hmtype = this.hamonizeContract.find((item)=> item.hamonize_id === hm_id)
              console.log(hmtype.hamonize.hamonize_code);
              // console.log(index2);
            let url = {
              startDate: lastMonth,
              endDate: date.toISOString().split('T')[0],
              hmcode: hmtype.hamonize.hamonize_code
            }
            this.dispatchAction('GET_CONFIRM_FP',this.genUrl(url))
            console.log(url)
          }

          //     // const setData = (date)=> 
          //     let index = e.currentTarget.id
          //     let oldDate = new Date(this.data.cl_date)
          //     let hamonize_weight = JSON.parse(JSON.stringify(e.model.item.hamonize_weight))
          //     // console.log();
          //     oldDate.setMonth(oldDate.getMonth() - 3)
          //     let dataSend = {
          //       startDate: oldDate.toISOString().split('T')[0],
          //       endDate: this.data.cl_date,
          //       hmcode: e.model.item.hamonize_id
          //     }
          //     this.read('./g2g/confirm/fp?' + this.genUrl(dataSend), (data) => {
          //       // JSON.parse(JSON.stringify(this.hamonizeContract));
          //       let price = (hamonize_weight* 1000) * data[0].fp3
          //       let ton = data[0].fp3
          //       // console.log(price,ton);
          //       this.set('costprice',this.formatNumber(price))
          //       this.set('cost_price',this.formatNumber(ton))
          //       // console.log('costprice',this.costprice,'cost_price',this.cost_price);
          //       this.set('data.cl_hamonize.' + index + '.costprice', price)
          //       this.set('data.cl_hamonize.' + index + '.cost_price', ton)
          //       let plus = this.data.cl_hamonize

          //       let cost_price = Object.keys(plus).reduce((previous, current) => previous + plus[current].cost_price, 0)
          //       this.set('data.cl_total_costpriceton', this.formatNumber(this.cost_price))

          //       let costpricex = Object.keys(plus).reduce((previous, current) => previous + plus[current].costprice, 0)
          //       this.set('data.cl_total_costprice', this.formatNumber(this.costprice))
          //     })
        } catch (e) {
          // console.log(e);
        }

      },
      addNewTypeRice: function () {
        this.push('data.cl_hamonize', {
          hamonize_id: '',
          hamonize_weight: 0,
          package:
          [
            {
              package_id: '',
              price_d: 0,
            }
          ]
        });
      },
      addPackage: function (e) {
        let id = e.currentTarget.id;
        let data = {
          package_id: '',
          price_d: 0,
          package_weight_bag: 0,
        };
        this.push('data.cl_hamonize.' + [id] + '.package', data);
      },
      _obChangePrice: function (data, list) {
        let result = "";
        if (list.package_id != '') {
          list.map((packages, index) => {
            if (packages.package_id === data) {
              result = packages.package_weight_bag;
            }
          });
          return result;
        }
      },
      backPage: function () {
        //   let breadcrumbs = datass = [
        //     {
        //       label: this.dataForSelect.contract_name,
        //       href: ''
        //     },
        //     {
        //       label: 'รายการสัญญาย่อย',
        //       href: ''
        //     },
        //   ]
        //   // console.log(breadcrumbs);
        //   this.fire('_set-breadcrumbs', breadcrumbs)
        //   if (this.commonState.btnDisabled == false) {
        //     this.editInput();
        //   }
        this.fire('back-page-confirm', { detail: '_back-page-confirm' });
      },
      // backPageInsert: function () {

      //   this.fire('back-page-confirm', { detail: '_back-page-confirm' });
      // },
      editConfirm: function () {
        this.dispatchAction('SET_STATE', {
          isInsert: false,
          btnDisabled: false,
          hiddend: true
        })
      },
      _getHamonize: function () {
        try {
          let hamonize = this.data.cl_hamonize
          // console.log(hamonize);
          for (var index = 0; index < hamonize.length; index++) {
            hamonize[index].hamonize = this.dataShow.cl_hamonize[index].hamonize
            for (var index2 = 0; index2 < hamonize[index].package.length; index2++) {
              let dataPackage = this.packageList.find((item) => item.package_id === hamonize[index].package[index2].package_id)
              // console.log(dataPackage);
              let package = {
                id: dataPackage.package_id,
                package_kg_per_bag: dataPackage.package_kg_per_bag,
                package_name_en: dataPackage.package_name_en,
                package_name_th: dataPackage.package_name_th,
                package_weight_bag: dataPackage.package_weight_bag
              }
              hamonize[index].package[index2].package = package
            }
          }
          // console.log(hamonize);
          return hamonize
        } catch (e) {
          // console.log(e);
        }

      },
      _resiveDataConfirm: function () {
        this._getHamonize()
        return new Promise((res, rej) => {
          let dataResive = this.data
          // console.log(this.data);
          dataResive.cl_date = new Date(this.data.cl_date),
            // dataResive.cl_hamonize = this._getHamonize(),
            dataResive.cl_status = this.data.cl_status,
            dataResive.cl_weight = this.data.cl_weight,
            dataResive.incoterms = this.dataShow.incoterms//this._getIncoterms()
          delete dataResive.date_updated
          delete dataResive.date_created
          res(dataResive)
        })
      },
      _resiveFormConfirm: function () {
        return new Promise((res, rej) => {
          if (this.validateForm('.required')) {
            this._resiveDataConfirm().then((data) => {
              res(data)
            })
          } else {
            this.fire('toast', {
              status: 'connectError', text: 'กรุณากรอกข้อมูลให้ครบทุกช่อง', //คำสั่งสำหรับเปิด toast error
              callback: function () {
                rej('error')
              }
            })
          }
        })
      },
      insertConfirm: function () {
        this._resiveFormConfirm()
          .then((res) => {
            // console.log(res);
            this.fire('toast', { status: 'load' }); //คำสั่งสำหรับเปิด toast load
            this.dispatchAction('POST_CONFIRM', res)
              .then((response) => {
                if (response.data.inserted !== undefined && response.data.inserted.length !== 0) {

                  let url = { contract_id: this.contractId.contract_id, status: 'all' }
                  this.dispatchAction('GET_CONFIRM_LIST', this.genUrl(url))
                  this.dispatchAction('GET_CONTRACT_OF_BUYER', this.getCookieBhv("buyerId"));
                  this.fire('toast', {
                    status: 'success', text: 'บันทึกสำเร็จ',  // คำสั่งสำหรับเปิด toast success
                    callback: () => {
                      this.queryFrom('.required').map((el) => { el.reset(); });
                      this.backPage()
                    }
                  })
                } else {
                  // console.log(1111);
                  this.fire('toast', {
                    status: 'connectError', text: response.data, //คำสั่งสำหรับเปิด toast error
                    callback: () => {
                    }
                  })
                }
              })
          })
          .catch((error) => {
            console.log(error);
          })

        // this._getIncoterms()
        //   this.data.cl_status = false;
        //   // console.log(this.dataForSelect);
        //   this.set('data.tags', [this.dataForSelect.buyer_id, this.dataForSelect.country_id]);
        //   // console.log(this.data);
        //   // this.data.cl_close = false
        //   this._clearnDataConfirm(this.data, (data) => {
        //     if (this.dataForSelect.cl_total_quantity <= this.dataForSelect.contract_quantity_confirm_balance) {
        //       data.contract_id = this.dataForSelect.contract_id;
        //       this.fire('toast', { status: 'load' }); //คำสั่งสำหรับเปิด toast load
        //       // console.log(data);
        //       this.insert('./g2g/confirm/insert', data, () => {
        //         this.fire('get-list-confirm', { contractId: data.contract_id });
        //         this.fire('toast', {
        //           status: 'success', text: 'บันทึกสำเร็จ',  // คำสั่งสำหรับเปิด toast success
        //           callback: () => {

        //             this.fire('back-page-confirm', { detail: '_back-page-confirm' });
        //           }
        //         });
        //       });
        //       let el = Polymer.dom(this.root).querySelectorAll('.required');
        //       el.map((el) => { el.reset(); el.value = '' });
        //       this._changeDataConfirm('undefined');
        //     } else {
        //       this.fire('toast', {
        //         status: 'connectError', text: 'คุณใส่ปริมาณข้าวที่คงเหลือเกินจำนวน ' + this.dataForSelect.contract_quantity_confirm_balance + ' ตัน', //คำสั่งสำหรับเปิด toast error
        //         callback: function () {
        //         }
        //       })
        //     }
        //     // this.editInput();
        //   });

      },
      saveConfirm: function () {
        this.fire('toast', {
          status: 'openDialog',
          text: 'ต้องการแก้ข้อมูลใช่หรือไม่ ?',
          confirmed: (result) => {
            if (result == true) {
              this._resiveFormConfirm()
                .then((res) => {
                  // console.log(res);
                  // console.log(this.dataShow);
                  this.fire('toast', { status: 'load' }); //คำสั่งสำหรับเปิด toast load
                  this.dispatchAction('PUT_CONFIRM', res)
                    .then((response) => {
                      if (response.data.replaced !== undefined && response.data.replaced.length !== 0) {
                        let url = { contract_id: this.contractId.contract_id, status: 'all' }
                        this.dispatchAction('GET_CONFIRM_LIST', this.genUrl(url))
                        this.dispatchAction('GET_CONTRACT_OF_BUYER', this.getCookieBhv("buyerId"));
                        this.queryFrom('.required').map((el) => { el.reset(); });
                        this.dispatchAction('SET_STATE', {
                          isInsert: false,
                          btnDisabled: true,
                          hiddend: true
                        })
                        this.fire('toast', {
                          status: 'success', text: 'บันทึกสำเร็จ',  // คำสั่งสำหรับเปิด toast success
                          callback: () => {
                          }
                        })
                      } else {
                        // console.log(1111);
                        this.fire('toast', {
                          status: 'connectError', text: response.data, //คำสั่งสำหรับเปิด toast error
                          callback: () => {
                          }
                        })
                      }
                    })
                })
                .catch((error) => {
                  console.log(error);
                });
              // }

            }
          }
        })
        //   // console.log(this.cl_total_quantity,'=',this.dataForSelect.contract_quantity_confirm_balance);
        //   this._clearnDataConfirm(this.data, (data) => {
        //     if (this.dataForSelect.cl_total_quantity <= this.dataForSelect.contract_quantity_confirm_balance) {
        //       data.contract_id = this.dataForSelect.contract_id;
        //       data.id = this.data.cl_id;
        //       this.fire('toast', {  //คำสั่งสำหรับเปิด toast dialog
        //         status: 'dialog',
        //         text: 'ต้องการแก้ข้อมูลใช่หรือไม่ ?',
        //         confirmed: this._saveData.bind(this), //function ที่ใช้รับค่า ปุ่ม
        //         el: this, // compontents
        //         data: data // ข้อมูลที่ส่งไป เช่น id ที่จะใช้ลบข้อมูล ใน db
        //       })
        //     } else {
        //       this.fire('toast', {
        //         status: 'connectError', text: 'คุณใส่ปริมาณข้าวที่คงเหลือเกินจำนวน ' + this.dataForSelect.contract_quantity_confirm_balance + ' ตัน', //คำสั่งสำหรับเปิด toast error
        //         callback: function () {
        //         }
        //       })
        //     }
        // })
        // },
        // _saveData: function (result, detail) {
        //   if (result == true) {
        //     detail.el.update('./g2g/confirm/update', detail.data, () => {
        //       detail.el.fire('refresh-contract', { detail: 'refresh-contract' });
        //       detail.el.fire('toast', {
        //         status: 'success', text: 'บันทึกสำเร็จ',  // คำสั่งสำหรับเปิด toast success
        //         callback: function () {
        //           //  detail.el.editInput();
        //           detail.el.editInput();
        //           detail.el.fire('get-confirm-detail', { clId: detail.data.id });
        //           // detail.el.data = detail.data;
        //           detail.el.fire('get-list-confirm', { contractId: detail.data.contract_id });
        //         }
        //       });
        //     });
        //   }
      },
      confirmConfirm: function () {
        this.fire('toast', {
          status: 'openDialog',
          text: 'ต้องการยืนยันสัญญาใช่หรือไม่ ?',
          confirmed: (result) => {
            if (result == true) {
              this._resiveFormConfirm()
                .then((res) => {
                  res.cl_status = true
                  this.fire('toast', { status: 'load' }); //คำสั่งสำหรับเปิด toast load
                  this.dispatchAction('PUT_CONFIRM', res)
                    .then((response) => {
                      if (response.data.replaced !== undefined && response.data.replaced.length !== 0) {
                        let url = { contract_id: this.contractId.contract_id, status: 'all' }
                        this.dispatchAction('GET_CONFIRM_LIST', this.genUrl(url))
                        this.dispatchAction('GET_CONTRACT_OF_BUYER', this.getCookieBhv("buyerId"));
                        this.queryFrom('.required').map((el) => { el.reset(); });
                        this.dispatchAction('SET_STATE', {
                          isInsert: false,
                          btnDisabled: true,
                          hiddend: true
                        })
                        this.fire('toast', {
                          status: 'success', text: 'บันทึกสำเร็จ',  // คำสั่งสำหรับเปิด toast success
                          callback: () => {
                          }
                        })
                      } else {
                        // console.log(1111);
                        this.fire('toast', {
                          status: 'connectError', text: response.data, //คำสั่งสำหรับเปิด toast error
                          callback: () => {
                          }
                        })
                      }
                    })
                })
                .catch((error) => {
                  console.log(error);
                });
            }
          }
        })
        //   //  this.editInput()
        //   this._clearnDataConfirm(this.data, (data) => {
        //     if (this.dataForSelect.cl_total_quantity <= this.dataForSelect.contract_quantity_confirm_balance) {
        //       data.contract_id = this.dataForSelect.contract_id;
        //       data.id = this.data.cl_id;
        //       data.cl_status = this.approve(data.cl_status);
        //       this.fire('toast', {  //คำสั่งสำหรับเปิด toast dialog
        //         status: 'dialog',
        //         text: 'ต้องการยืนยันข้อมูลใช่หรือไม่ ?',
        //         confirmed: this._confirmData, //function ที่ใช้รับค่า ปุ่ม
        //         el: this, // compontents
        //         data: data // ข้อมูลที่ส่งไป เช่น id ที่จะใช้ลบข้อมูล ใน db
        //       })
        //     } else {
        //       this.fire('toast', {
        //         status: 'connectError', text: 'คุณใส่ปริมาณข้าวที่คงเหลือเกินจำนวน ' + this.dataForSelect.contract_quantity_confirm_balance + ' ตัน', //คำสั่งสำหรับเปิด toast error
        //         callback: function () {
        //         }
        //       })
        //     }
        //   });
      },
      // _confirmData: function (result, detail) {
      //   if (result == true) {
      //     detail.el.update('./g2g/confirm/update', detail.data, () => {
      //       detail.el.fire('refresh-contract', { detail: 'refresh-contract' });
      //       detail.el.fire('toast', {
      //         status: 'success', text: 'บันทึกสำเร็จ',  // คำสั่งสำหรับเปิด toast success
      //         callback: function () {
      //           //  detail.el.editInput();
      //           detail.el.fire('get-confirm-detail', { clId: detail.data.id });
      //           // detail.el.data = detail.data;
      //           detail.el.fire('get-list-confirm', { contractId: detail.data.contract_id });
      //         }
      //       });
      //     });
      //   }
      // },
      deleteConfirm: function () {
        this.fire('toast', {
          status: 'openDialog',
          text: 'ต้องการลบข้อมูลใช่หรือไม่ ?',
          confirmed: (result) => {
            if (result == true) {
              // console.log(res);
              this.fire('toast', { status: 'load' }); //คำสั่งสำหรับเปิด toast load
              this.dispatchAction('DELETE_CONFIRM', this.data.id)
                .then((response) => {
                  if (response.data.deleted !== undefined && response.data.deleted.length !== 0) {
                    this.dispatchAction('GET_CONTRACT_OF_BUYER', this.getCookieBhv("buyerId"));
                    let url = { contract_id: this.contractId.contract_id, status: 'all' }
                    this.dispatchAction('GET_CONFIRM_LIST', this.genUrl(url))
                    this.fire('toast', {
                      status: 'success', text: 'ลบสำเร็จ',  // คำสั่งสำหรับเปิด toast success
                      callback: () => {
                        this.backPage()
                      }
                    })
                  } else {
                    // console.log(1111);
                    this.fire('toast', {
                      status: 'connectError', text: response.data, //คำสั่งสำหรับเปิด toast error
                      callback: () => {
                      }
                    })
                  }
                })
            }
          }
        })
        //   this.fire('toast', {  //คำสั่งสำหรับเปิด toast dialog
        //     status: 'dialog',
        //     text: 'ต้องการลบข้อมูลใช่หรือไม่ ?',
        //     confirmed: this._deleteDataConfirm.bind(this), //function ที่ใช้รับค่า ปุ่ม
        //     el: this, // compontents
        //     data: this.data // ข้อมูลที่ส่งไป เช่น id ที่จะใช้ลบข้อมูล ใน db
        //   })
      },
      // _deleteDataConfirm: function (result, detail) {
      //   if (result == true) {
      //     // console.log(detail.data.cl_id);
      //     this.delete('./g2g/confirm/delete/id/', detail.data.cl_id, () => {
      //       detail.el.fire('get-list-confirm', { contractId: detail.data.contract_id });
      //       this.fire('toast', {
      //         status: 'success', text: 'ลบสำเร็จ',  // คำสั่งสำหรับเปิด toast success
      //         callback: function () {

      //           //        //  detail.el.editInput();
      //           detail.el.fire('back-page-confirm', { detail: '_back-page-confirm' });
      //           // this.fire('get-confirm-detail', { clId: detail.data.id });
      //           //       // detail.el.data = detail.data;
      //           //       //  this.oldData={};
      //           // this.backPage();
      //         }
      //       });


      //     });
      //   }
      // },
      _typeRiceConfirm: function () {
        // console.log('this.data.cl_hamonize',this.data.cl_hamonize);
        this.async(() => {
          let comboboxs, arrForItem, itemif;
          try {
            for (var i = 0; i < this.data.cl_hamonize.length; i++) {
              arrForItem = JSON.parse(JSON.stringify(this.hamonizeContract));
              // console.log('arrForItem', arrForItem);
              this.data.cl_hamonize.map((item, index) => {
                //  console.log(item);
                if (i != index) {
                  //ตัดอาเรย์ตอนที่ไม่เท่ากับค่าของตัวเอง
                  if (arrForItem.filter((blDetail) => blDetail.hamonize_id == item.hamonize_id)[0] != undefined) {
                    itemif = arrForItem.indexOf(arrForItem.filter((blDetail) => blDetail.hamonize_id == item.hamonize_id)[0]);
                    //  console.log(itemif);
                    arrForItem.splice(itemif, 1);
                  }
                }
              });
              comboboxs = Polymer.dom(this.root).querySelector('#riceType-' + i);
              comboboxs.items = arrForItem;
            }
          } catch (e) {
            //  console.log(e);
          }
        }, 1);
      },
      _typePackageConfirm: function () {
        this.async(() => {
          let comboboxs, arrForItem, itemif;
          try {
            for (var i = 0; i < this.data.cl_hamonize.length; i++) {
              for (var j = 0; j < this.data.cl_hamonize[i].package.length; j++) {
                arrForItem = JSON.parse(JSON.stringify(this.packageList));
                //  console.log('this.data.cl_hamonize',arrForItem);
                //  console.log('arrForItem',arrForItem);
                this.data.cl_hamonize[i].package.map((item, index) => {
                  // console.log(item);
                  if (j != index) {
                    //ตัดอาเรย์ตอนที่ไม่เท่ากับค่าของตัวเอง
                    if (arrForItem.filter((blDetail) => blDetail.package_id == item.package_id)[0] != undefined) {
                      itemif = arrForItem.indexOf(arrForItem.filter((blDetail) => blDetail.package_id == item.package_id)[0]);
                      arrForItem.splice(itemif, 1);
                    }
                  }
                });
                // console.log(arrForItem);
                // package-[[index]]-[[indexpackeage]]
                comboboxs = Polymer.dom(this.root).querySelector('#package-' + i + '-' + j);
                // console.log(comboboxs);
                comboboxs.items = arrForItem;
              }
            }
          } catch (e) {
            //  console.log(e);
          }
        }, 1);
      },
      _incotermsConfirm: function () {
        this.async(() => {
          let comboboxs, arrForItem, itemif;
          try {
            for (var i = 0; i < this.data.incoterms.length; i++) {
              arrForItem = JSON.parse(JSON.stringify(this.incotermsList));
              //  console.log('arrForItem',arrForItem);
              this.data.incoterms.map((item, index) => {
                //  console.log(item);
                if (i != index) {
                  //ตัดอาเรย์ตอนที่ไม่เท่ากับค่าของตัวเอง
                  if (arrForItem.filter((incoterm) => incoterm.inct_id == item.inct_id)[0] != undefined) {
                    itemif = arrForItem.indexOf(arrForItem.filter((incoterm) => incoterm.inct_id == item.inct_id)[0]);
                    //  console.log(itemif);
                    arrForItem.splice(itemif, 1);
                  }
                }
              });
              comboboxs = Polymer.dom(this.root).querySelector('#incoterms-' + i);
              comboboxs.items = arrForItem;
            }
          } catch (e) {
            //  console.log(e);
          }
        }, 1);
      },
      getObjectIncoterms: function (e) {
        if (e.detail.value !== null) {
          let indexIn = e.currentTarget.index
          let dataIncoterms = {
            inct_id: e.detail.value.inct_id,
            inct_name: e.detail.value.inct_name
          }
          this.set('dataShow.incoterms.' + indexIn, dataIncoterms)
        }
      },
      getObjectHamonize: function (e) {
        if (e.detail.value !== null) {
          let indexIn = e.currentTarget.index
          let dataHamonize = JSON.parse(JSON.stringify(e.detail.value));
          delete dataHamonize.label
          this.set('dataShow.cl_hamonize.' + indexIn, dataHamonize)
        }
      },
      // getObjectPackeage: function (e) {
      //   if (e.detail.value !== null) {
      //     let indexHa = e.currentTarget.index
      //     let indexPk = e.currentTarget.indexpackeage
      //     let dataPackage = JSON.parse(JSON.stringify(e.detail.value));
      //     // console.log(dataPackage);
      //     let package = {
      //       package: {
      //         id: dataPackage.package_id,
      //         package_kg_per_bag: dataPackage.package_kg_per_bag,
      //         package_name_en: dataPackage.package_name_en,
      //         package_name_th: dataPackage.package_name_th,
      //         package_weight_bag: dataPackage.package_weight_bag
      //       },
      //       package_id: dataPackage.package_id,
      //     }
      //     // delete dataHamonize.label
      //     console.log(indexHa,indexPk);
      //     console.log(package);
      //     this.set('dataShow.cl_hamonize_pk.' + indexHa + '.package.' + indexPk, package)
      //     console.log(this.dataShow.cl_hamonize_pk);
      //   }
      // },


      // _clearnDataConfirm: function (data, callback) {
      //   let el = Polymer.dom(this.root).querySelectorAll('.required');
      //   let stat = el.map((el) => el.validate());
      //   if (stat.every(elem => elem == true)) {
      //     let { cl_date, cl_no, cl_quality, cl_status } = data;
      //     let newData = { cl_date, cl_no, cl_quality, cl_status };
      //     newData.cl_hamonize = [];
      //     newData.incoterms = [];
      //     newData.cl_date = new Date(newData.cl_date);
      //     data.incoterms.map((item) => {
      //       // console.log(item.inct_id);
      //       newData.incoterms.push({ inct_id: item.inct_id })
      //     })

      //     data.cl_hamonize.map((cl_hamonize, index) => {
      //       newData.cl_hamonize.push({
      //         hamonize_id: cl_hamonize.hamonize_id,
      //         hamonize_weight: cl_hamonize.hamonize_weight,
      //         tolerance_rate: cl_hamonize.tolerance_rate,
      //         project_th: cl_hamonize.project_th,
      //         project_en: cl_hamonize.project_en,
      //         cost_price: cl_hamonize.cost_price,
      //         costprice: cl_hamonize.costprice,
      //         // season_th:cl_hamonize.season_th,
      //         // season_en:cl_hamonize.season_en,
      //         //description_th:cl_hamonize.description_th,
      //         //description_en:cl_hamonize.description_en,
      //         package: []
      //       });
      //       cl_hamonize.package.map((packages) => {
      //         newData.cl_hamonize[index].package.push({
      //           package_id: packages.package_id,
      //           price_d: packages.price_d
      //         }
      //         );
      //       });
      //     });
      //     if (typeof data.tags !== 'undefined') {
      //       newData.tags = new Array();
      //       data.tags.map((tag) => {
      //         newData.tags.push(tag);
      //       });
      //     }
      //     // el.map((el)=> console.log(el));
      //     el.map((el) => el.reset());
      //     callback(newData);
      //   } else {
      //     this.fire('toast', {
      //       status: 'connectError', text: 'กรุณากรอกข้อมูลให้ครบทุกช่อง', //คำสั่งสำหรับเปิด toast error
      //       callback: function () {
      //       }
      //     })
      //   }
      // },
    });
  </script>
</dom-module>